version: 2
jobs:
   build:
     docker:
         - image: docker:17.05.0-ce-git
     steps:
       - checkout
       - setup_remote_docker
       - run:
            name: Build application docker image
            command: |
                docker build --cache-from=microdraw -t microdraw .
       - run:
            name: save docker image layer cache
            command: |
                mkdir -p /caches
                docker save -o /caches/microdraw.tar microdraw
       - run:
            name: run tests
            command: |
                docker run -it microdraw tests

